<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Site extends MX_Controller {			public function __construct(){		parent::__construct();                $this->load->helper('form');                	}			public function index(){		$this->page->template('login_tpl');	        $this->page->view();		}                  		public function login(){    $username	= $this->input->post('username');	$password	= $this->input->post('password');     	//$dn = "DC=gmf-aeroasia,DC=co,DC=id";    //$ldapconn 	= ldap_connect("192.168.240.26")  or die("Could not connect to LDAP server.");        	if(isset($_POST['b_login']))	{//          ldap_set_option(@$ldap, LDAP_OPT_PROTOCOL_VERSION,3);//          ldap_set_option(@$ldap, LDAP_OPT_REFERRALS,0);//                                                            //			if (@$ldapconn) //			{//				$ldapbind = ldap_bind($ldapconn, "ldap", "aeroasia");//			//				if ($ldapbind) //				{			//				    //					$sr			= ldap_search($ldapconn, $dn, "samaccountname=$username"); 				//					$info 		= ldap_get_entries($ldapconn, $sr);//                                        								//					echo $info[0]["samaccountname"][0];//					//					if(@$info[0]["samaccountname"][0] == $username)//					{				//						$bind		= @ldap_bind($ldapconn, $info[0][dn], $password);//						//						if( !$bind || !isset($bind))//						{							//							$this->session->set_flashdata('status', 'failed'); //                            redirect(base_url()); //                            redirect(site_url('home'));//						}//						else//						{											                        $query = "SELECT TSH.PERNR, TSH.EMPLNAME,(meg.id_group_fk) AS id_employee_group, TSH.UNIT, TSH.BORNDATE, TSH.EMPLODATE, TSH.WORKUNTILDATE, TSH.REPORT_TO, TSH.EMPL_PHOTO FROM db_hrm.dbo.TBL_SOE_HEAD AS TSH                                LEFT JOIN m_employee_group AS meg ON TSH.PERNR = meg.personnel_number_fk WHERE TSH.PERNR = '$username'";                                                                        $src = $this->db->query($query);        		                        if ($src->num_rows() == 0) {                                $this->session->set_flashdata('status', 'failed');                                redirect(base_url());                        }                        else                         {                                $users = $src->row();                                $this->session->set_userdata('users', $users);			                                redirect(site_url('home'));                        } 						//						}//					}		//					else//					{//						$this->session->set_flashdata('status', 'failed'); //                        redirect(base_url());                                                                //					}		//				} //				else //				{//					$this->session->set_flashdata('status', 'failed');//                    redirect(base_url());             //				}		//				ldap_close($ldapconn);	//			}	   }				    }				public function logout(){		$this->session->sess_destroy();		redirect(base_url());        	}	}/* End of file site.php *//* Location: ./application/controllers/site.php */